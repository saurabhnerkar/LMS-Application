{% extends 'base.html' %}

{% block content %}
{% include 'student/_sidebar.html' %}
<div class="main-content" style="margin-left:200px; padding:35px; background:#f4f8fb; min-height:100vh;">
    <a href="javascript:history.back()" class="btn btn-outline-danger go-back-btn" >
    <i class="fas fa-arrow-left"></i> Go Back
  </a>
    <h3 class="mb-3 text-dark text-center fw-bold">{{ assignment.title }}</h3>
    <p><strong>Instructions:</strong> {{ assignment.instructions|linebreaks }}</p>
    <p><strong>Due Date:</strong> {{ assignment.due_date|date:"d M Y" }}</p>

    {% if assignment.upload_file %}
        <div class="mt-4">
            <strong>Attached File:</strong><br>
            {% with file_url=assignment.upload_file.url|lower %}
                {% if '.pdf' in file_url %}
                    <!-- PDF Viewer -->
                    <iframe src="{{ assignment.upload_file.url }}" width="100%" height="600px" style="border:none;"></iframe>
                {% elif '.jpg' in file_url or '.jpeg' in file_url or '.png' in file_url %}
                    <!-- Image Viewer -->
                    <img src="{{ assignment.upload_file.url }}" alt="Assignment File" class="img-fluid rounded mt-2">
                {% elif '.mp4' in file_url or '.webm' in file_url %}
                    <!-- Video Viewer -->
                    <video controls width="100%" class="mt-2 rounded">
                        <source src="{{ assignment.upload_file.url }}">
                        Your browser does not support the video tag.
                    </video>
                {% else %}
                    <!-- Other file types -->
                    <p><a href="{{ assignment.upload_file.url }}" target="_blank">Download/View File</a></p>
                {% endif %}
            {% endwith %}
        </div>
    {% endif %}

    <hr class="my-4">

    <!-- Assignment Submission Section -->
    <h4 class="text-dark text-center mb-3">Submit Your Assignment</h4>

    {% if existing_submission %}
    <div class="alert alert-info">
        <strong>You have already submitted this assignment.</strong><br>
        <p>Submitted on: {{ existing_submission.submitted_on|date:"d M Y, h:i A" }}</p>
        <p><a href="{{ existing_submission.file.url }}" target="_blank"><button class="btn btn-info">View Your Submitted File</button></a></p>
        {% if existing_submission.grade or existing_submission.remarks %}
    <hr class="my-3">
    <div class="alert alert-success">
        <h5 class="text-success">Teacher's Feedback</h5>
        {% if existing_submission.grade %}
            <p><strong>Grade:</strong> {{ existing_submission.grade }}</p>
        {% endif %}
        {% if existing_submission.remarks %}
            <p><strong>Remarks:</strong> {{ existing_submission.remarks }}</p>
        {% endif %}
    </div>
{% else %}
    <div class="alert alert-warning mt-3">
        <p><strong>Status:</strong> Your submission has not been graded yet.</p>
    </div>
{% endif %}

    </div>

    <a href="{% url 'student:edit_submission' course.id assignment.id %}" class="btn btn-warning me-2">Edit Submission</a>
    <a href="{% url 'student:delete_submission' course.id assignment.id %}" class="btn btn-danger">Delete Submission</a>
{% else %}
    <form method="POST" enctype="multipart/form-data" 
          action="{% url 'student:submit_assignment' course.id assignment.id %}" 
          class="mt-3">
        {% csrf_token %}
        <div class="mb-3">
            <label for="file" class="form-label">Upload Your File:</label>
            <input type="file" name="file" id="file" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-success">Submit Assignment</button>
    </form>
{% endif %}
</div>
{% endblock %}
