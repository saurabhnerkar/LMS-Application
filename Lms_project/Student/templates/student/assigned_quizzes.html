{% extends 'base.html' %}

{% block title %}Available Quizzes{% endblock %}

{% block content %}
{% include "student/_sidebar.html" %}
<div class="main-content" style="margin-left:200px; padding:35px; background:#f4f8fb; min-height:100vh;">
  <a href="javascript:history.back()" class="btn btn-outline-danger go-back-btn" >
    <i class="fas fa-arrow-left"></i> Go Back
  </a>
  <h3 class="mb-4 text-dark text-center fw-bold">Quizzes</h3>

  {% if quizzes %}
    <div class="row">
      {% for quiz in quizzes %}
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h5 class="card-title">{{ quiz.title }}</h5>

              {# ---- Status Badge (checks both date + time) ---- #}
              {% if quiz.start_time and quiz.end_time %}
                  {% if quiz.start_time > now %}
                      <span class="badge bg-warning text-dark">
                          Upcoming (Starts {{ quiz.start_time|date:"d M Y H:i" }})
                      </span>
                  {% elif quiz.end_time < now %}
                      <span class="badge bg-danger">
                          Ended (Ended {{ quiz.end_time|date:"d M Y H:i" }})
                      </span>
                  {% else %}
                      <span class="badge bg-success">
                          Active (Ends {{ quiz.end_time|date:"d M Y H:i" }})
                      </span>
                  {% endif %}
              {% else %}
                  <span class="badge bg-secondary">No Schedule</span>
              {% endif %}

              <p class="card-text text-muted mt-2">
                {{ quiz.description|default:"No description available."|truncatewords:15 }}
              </p>

              {# ---- Action Buttons ---- #}
              {# ---- Action Buttons ---- #}
{% if quiz.start_time and quiz.end_time %}
    {% if quiz.start_time <= now and quiz.end_time >= now %}
        <a href="{% url 'student:take_quiz' course.id quiz.id %}" class="btn btn-outline-primary btn-sm">
            Take Quiz (Active - Ends {{ quiz.end_time|date:"H:i" }})
        </a>
    {% elif quiz.start_time > now %}
        <button class="btn btn-outline-secondary btn-sm" disabled>
            Starts at {{ quiz.start_time|date:"d M Y H:i" }}
        </button>
    {% else %}
        <a href="{% url 'student:quiz_result' course.id quiz.id %}" class="btn btn-outline-success btn-sm">
            View Result
        </a>
    {% endif %}
{% else %}
    <button class="btn btn-outline-secondary btn-sm" disabled>No Time Set</button>
{% endif %}
      </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No quizzes available for this course yet.</p>
  {% endif %}
</div>
{% endblock %}